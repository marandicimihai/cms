<StatusIndicator @ref="statusIndicator" />

<SortAndFilterOptions 
    OnSortChanged="OnSortChangedAsync"
    SortableProperties="SortableProperties"
    InitialSortByProperty="CreatedAt"
    InitialDescending="true" />

@if (Properties != null)
{
    <Table>
        <TableHead>
            <TableRow>
                <TableHeader Class="px-3 py-2">
                    <input type="checkbox" aria-label="Select all entries" checked="@IsAllSelected" @onchange="ToggleSelectAllHandler" />
                </TableHeader>
                <TableHeader Class="font-mono text-xs">ID</TableHeader>
                @foreach (var prop in Properties)
                {
                    <TableHeader>@prop.Name</TableHeader>
                }
                <TableHeader>Created At</TableHeader>
                <TableHeader>Updated At</TableHeader>
                <TableHeader Class="text-right">Actions</TableHeader>
            </TableRow>
        </TableHead>
        <TableBody>
        @if (Entries.Any())
        {
            @foreach (var entry in Entries)
            {
                <TableRow>
                    <TableData Class="px-3 py-2">
                        <input type="checkbox" aria-label="Select entry @entry.Id" checked="@IsEntrySelected(entry)" @onchange="@(e => ToggleEntrySelection(entry, e.Value as bool? ?? false))" />
                    </TableData>
                    <TableData Class="font-mono text-xs whitespace-nowrap">@entry.Id</TableData>
                    @foreach (var prop in Properties)
                    {
                        var cellValue = GetEntryPropertyValue(entry, prop.Name);
                        <TableData Class="truncate max-w-[240px]">
                            @FormatCell(cellValue)
                        </TableData>
                    }
                    <TableData Class="whitespace-nowrap">
                        @FormatCell(entry.CreatedAt)
                    </TableData>
                    <TableData Class="whitespace-nowrap">
                        @FormatCell(entry.UpdatedAt)
                    </TableData>
                    <TableData Class="text-right flex gap-2 justify-end">
                        <button class="inline-flex items-center justify-center rounded-md font-medium bg-blue-600 text-white hover:bg-blue-700 text-xs px-2.5 py-1.5" aria-label="Edit Entry" @onclick="() => RedirectToEdit(entry.Id)">
                            <span class="material-symbols-outlined icons-default text-base mr-1">edit</span>
                            Edit
                        </button>
                        <button class="inline-flex items-center justify-center rounded-md font-medium bg-rose-600 text-white hover:bg-rose-700 text-xs px-2.5 py-1.5" aria-label="Delete Entry" @onclick="() => OnDeleteEntry(entry)">
                            <span class="material-symbols-outlined icons-default text-base mr-1">delete</span>
                            Delete
                        </button>
                    </TableData>
                </TableRow>
            }
        }
        else
        {
            <TableRow>
                <TableData Class="px-3 py-4 text-slate-600 text-sm" colspan="@((Properties.Count + 5).ToString())">No entries yet.</TableData>
            </TableRow>
        }
        </TableBody>
    </Table>

    @if (SelectedEntries.Count > 0)
    {
        <div class="flex items-center justify-between mt-4 p-3 rounded-md border border-slate-200 bg-slate-50">
            <span class="text-sm text-slate-900">@SelectedEntries.Count entr@(SelectedEntries.Count == 1 ? "y" : "ies") selected</span>
            <div class="flex gap-2">
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-slate-200 text-slate-900 hover:bg-slate-300 text-sm px-3 py-2" aria-label="Cancel selection" @onclick="ClearSelection">Cancel</button>
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-blue-600 text-white hover:bg-blue-700 text-sm px-3 py-2" aria-label="Delete selected entries" @onclick="DeleteSelectedEntriesAsync">
                    <span class="material-symbols-outlined icons-default text-base mr-2">delete</span>
                    Delete
                </button>
            </div>
        </div>
    }

    @if (HasMoreEntries)
    {
        <div class="mt-3 flex">
            <button
                class="w-full inline-flex items-center justify-center text-slate-600 hover:bg-slate-100 text-sm font-medium px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-transparent"
                @onclick="LoadMoreEntriesAsync"
                aria-label="Load more entries"
                disabled="@isLoadingMore">
                @if (isLoadingMore)
                {
                    <span class="material-symbols-outlined icons-default text-2xl animate-spin mx-auto">progress_activity</span>
                }
                else
                {
                    <span class="flex-1 text-center">Load More</span>
                }
            </button>
        </div>
    }
}
<div class="hidden whitespace-pre"></div>