@using CMS.Main.DTOs.Entry

<StatusIndicator @ref="statusIndicator" />

@if (Properties != null)
{
    <QuickGrid TGridItem="EntryDto" @ref="quickGrid" ItemsProvider="LoadEntriesAsync" Pagination="@pagination" Class="w-full border border-slate-200 rounded-md">
        <TemplateColumn Title="" Class="px-3 py-2 w-12">
            <ColumnOptions>
                <div class="px-3 py-2">
                    <input type="checkbox" aria-label="Select all entries" checked="@IsAllSelected" @onchange="ToggleSelectAllHandler" />
                </div>
            </ColumnOptions>
            <ChildContent>
                <input type="checkbox" aria-label="Select entry @context.Id" checked="@IsEntrySelected(context)" @onchange="@(e => ToggleEntrySelection(context, e.Value as bool? ?? false))" />
            </ChildContent>
        </TemplateColumn>

        <PropertyColumn Property="@(e => e.Id)" Title="ID" Class="font-mono text-xs whitespace-nowrap" />

        @foreach (var prop in Properties)
        {
            <TemplateColumn Title="@prop.Name" Class="truncate max-w-[240px]">
                @{
                    var cellValue = GetEntryPropertyValue(context, prop.Name);
                }
                @FormatCell(cellValue)
            </TemplateColumn>
        }

        <TemplateColumn Title="Created At" Class="whitespace-nowrap">
            @FormatCell(context.CreatedAt)
        </TemplateColumn>

        <TemplateColumn Title="Updated At" Class="whitespace-nowrap">
            @FormatCell(context.UpdatedAt)
        </TemplateColumn>

        <TemplateColumn Title="Actions" Class="text-right">
            <div class="flex gap-2 justify-end">
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-blue-600 text-white hover:bg-blue-700 text-xs px-2.5 py-1.5" aria-label="Edit Entry" @onclick="() => RedirectToEdit(context.Id)">
                    <span class="material-symbols-outlined icons-default text-base mr-1">edit</span>
                    Edit
                </button>
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-rose-600 text-white hover:bg-rose-700 text-xs px-2.5 py-1.5" aria-label="Delete Entry" @onclick="() => OnDeleteEntry(context)">
                    <span class="material-symbols-outlined icons-default text-base mr-1">delete</span>
                    Delete
                </button>
            </div>
        </TemplateColumn>
    </QuickGrid>

    <div class="mt-3">
        <Paginator State="@pagination" />
    </div>

    @if (SelectedEntries.Count > 0)
    {
        <div class="flex items-center justify-between mt-4 p-3 rounded-md border border-slate-200 bg-slate-50">
            <span class="text-sm text-slate-900">@SelectedEntries.Count entr@(SelectedEntries.Count == 1 ? "y" : "ies") selected</span>
            <div class="flex gap-2">
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-slate-200 text-slate-900 hover:bg-slate-300 text-sm px-3 py-2" aria-label="Cancel selection" @onclick="ClearSelection">Cancel</button>
                <button class="inline-flex items-center justify-center rounded-md font-medium bg-blue-600 text-white hover:bg-blue-700 text-sm px-3 py-2" aria-label="Delete selected entries" @onclick="DeleteSelectedEntriesAsync">
                    <span class="material-symbols-outlined icons-default text-base mr-2">delete</span>
                    Delete
                </button>
            </div>
        </div>
    }
}
<div class="hidden whitespace-pre"></div>