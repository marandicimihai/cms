<StatusIndicator @ref="statusIndicator" />

<Table>
    <TableHead>
        <TableRow>
            <TableHeader Class="font-mono text-xs">ID</TableHeader>
            @if (Properties.Any())
            {
                @foreach (var prop in Properties)
                {
                    <TableHeader>@prop.Name</TableHeader>
                }
                <TableHeader>Created At</TableHeader>
                <TableHeader>Updated At</TableHeader>
                <TableHeader>Actions</TableHeader>
            }
            else
            {
                <TableHeader>No Properties</TableHeader>
                <TableHeader>Created At</TableHeader>
                <TableHeader>Updated At</TableHeader>
                <TableHeader>Actions</TableHeader>
            }
        </TableRow>
    </TableHead>
    <TableBody>
    @if (Entries.Any() && Properties.Any())
    {
        @foreach (var entry in Entries)
        {
            <TableRow>
                <TableData Class="font-mono text-xs whitespace-nowrap">@entry.Id</TableData>
                @foreach (var prop in Properties)
                {
                    var cellValue = GetEntryPropertyValue(entry, prop.Name);
                    <TableData Class="truncate max-w-[240px]">
                        @FormatCell(cellValue)
                    </TableData>
                }
                <TableData Class="whitespace-nowrap">
                    @FormatCell(entry.CreatedAt)
                </TableData>
                <TableData Class="whitespace-nowrap">
                    @FormatCell(entry.UpdatedAt)
                </TableData>
                <TableData Class="text-right flex gap-2">
                    <button class="inline-flex items-center justify-center rounded-md font-medium bg-blue-600 text-white hover:bg-blue-700 text-xs px-2.5 py-1.5" aria-label="Edit Entry" @onclick="() => EditEntry(entry.Id)">
                        <span class="material-symbols-outlined icons-default text-base mr-1">edit</span>
                        Edit
                    </button>
                    <button class="inline-flex items-center justify-center rounded-md font-medium bg-rose-600 text-white hover:bg-rose-700 text-xs px-2.5 py-1.5" aria-label="Delete Entry" @onclick="() => OnDeleteEntry(entry)">
                        <span class="material-symbols-outlined icons-default text-base mr-1">delete</span>
                        Delete
                    </button>
                </TableData>
            </TableRow>
        }
    }
    else
    {
        <TableRow>
            <TableData Class="px-3 py-4 text-slate-600 text-sm">No entries yet.</TableData>
        </TableRow>
    }
    </TableBody>
</Table>

@if (HasMoreEntries)
{
    <div class="mt-3 flex">
        <button
            class="w-full inline-flex items-center justify-center text-slate-600 hover:bg-slate-100 text-sm font-medium px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-transparent"
            @onclick="LoadMoreEntriesAsync"
            aria-label="Load more entries"
            disabled="@isLoadingMore">
            @if (isLoadingMore)
            {
                <span class="material-symbols-outlined icons-default text-2xl animate-spin mx-auto">progress_activity</span>
            }
            else
            {
                <span class="flex-1 text-center">Load More</span>
            }
        </button>
    </div>
}

<div class="hidden whitespace-pre"></div>